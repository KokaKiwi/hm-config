From e3552b820fd5ee5c6868026d3e632695847174b3 Mon Sep 17 00:00:00 2001
From: KokaKiwi <kokakiwi+git@kokakiwi.net>
Date: Tue, 15 Oct 2024 23:09:52 +0200
Subject: [PATCH 6/6] PR#5003: programs.fish: Configurable generation of
 completions
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Squashed commit of the following:

commit 925df7eb302603857655c63d956bcb31f6111ce0
Author: Jeffrey C. Ollie <jeff@ocjtech.us>
Date:   Mon Feb 5 19:34:52 2024 -0600

    programs.fish: Configurable generation of completions.

    Add a config option to optionally disable the generation of command
    completions based upon man pages.

commit e1aec543f5caf643ca0d94b6a633101942fd065f
Author: Kira Bruneau <kira.bruneau@pm.me>
Date:   Mon Oct 14 07:01:26 2024 -0400

    thunderbird: support setting search engines (#5697)

    * firefox: split search into separate submodule file

    * thunderbird: support setting search engines

commit 64c6325b28ebd708653dd41d88f306023f296184
Author: github-actions[bot] <github-actions[bot]@users.noreply.github.com>
Date:   Sun Oct 13 03:59:22 2024 +0000

    flake.lock: Update

    Flake lock file updates:

    • Updated input 'nixpkgs':
        'github:NixOS/nixpkgs/c31898adf5a8ed202ce5bea9f347b1c6871f32d1?narHash=sha256-yumd4fBc/hi8a9QgA9IT8vlQuLZ2oqhkJXHPKxH/tRw%3D' (2024-10-06)
      → 'github:NixOS/nixpkgs/5633bcff0c6162b9e4b5f1264264611e950c8ec7?narHash=sha256-9UTxR8eukdg%2BXZeHgxW5hQA9fIKHsKCdOIUycTryeVw%3D' (2024-10-09)
---
 modules/programs/fish.nix | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/modules/programs/fish.nix b/modules/programs/fish.nix
index 8cd7f9f9..e8db8b84 100644
--- a/modules/programs/fish.nix
+++ b/modules/programs/fish.nix
@@ -253,6 +253,15 @@ in {
         '';
       };
 
+      generateCompletions = mkOption {
+        type = types.bool;
+        default = true;
+        defaultText = literalExpression "true";
+        description = ''
+          Enable or disable the automatic generation of completions based upon installed man pages.
+        '';
+      };
+
       shellAliases = mkOption {
         type = with types; attrsOf str;
         default = { };
@@ -392,7 +401,9 @@ in {
   config = mkIf cfg.enable (mkMerge [
     {
       home.packages = [ cfg.package ];
+    }
 
+    (mkIf cfg.generateCompletions {
       # Support completion for `man` by building a cache for `apropos`.
       programs.man.generateCaches = mkDefault true;
 
@@ -456,7 +467,9 @@ in {
           set fish_complete_path $prev "${config.xdg.dataHome}/fish/home-manager_generated_completions" $post
         end
       '';
+    })
 
+    {
       xdg.configFile."fish/config.fish".source = fishIndent "config.fish" ''
         # ~/.config/fish/config.fish: DO NOT EDIT -- this file has been generated
         # automatically by home-manager.
-- 
2.47.0

